#HASS Version
 - platform: version
# Weather Prediction
 - platform: darksky
   api_key: !secret dark_sky_api
   update_interval: '00:10'
   monitored_conditions:
      - summary
      - precip_type
      - precip_intensity
      - precip_probability
      - temperature
      - apparent_temperature
      - wind_speed
      - wind_bearing
      - cloud_cover
      - humidity
      - daily_summary
      - temperature_max
      - temperature_min
      - precip_intensity_max
#WU
 - platform: wunderground
   api_key: !secret wu_api
   monitored_conditions:
     - alerts
     - temp_high_record_f
     - temp_high_1d_f
     - feelslike_f
     - temp_f
     - temp_low_1d_f
     - temp_low_record_f
     - precip_1d
     - precip_1d_in
     - wind_mph
     - wind_1d_mph
     - weather_1d
     - weather_1n
     - weather_2d
     - weather_2n
     - weather_3d
     - weather_3n
     - weather_4d
     - weather_4n

# Roomba  Control
 - platform: thinkingcleaner
# TED500
 - platform: ted5000
   name: main
   host: !secret ted_ip
   port: 80
# Speed Test
 - platform: speedtest
   monitored_conditions:
     - ping
     - download
     - upload
#PLEX
 - platform: plex
   username: !secret email
   password: !secret plex_pass
#SABNZBD
 - platform: sabnzbd
   host: !secret sabnzbd_host
   api_key: !secret sabnzbd_api
   monitored_variables:
     - 'current_status'
     - 'speed'
     - 'queue_size'
     - 'queue_remaining'
     - 'disk_size'
     - 'disk_free'
     - 'queue_count'
#RING
 - platform: ring
   monitored_conditions:
     - battery
     - last_activity
     - last_ding
     - last_motion
     - volume

#Pocket Casts
 - platform: pocketcasts
   username: !secret email
   password: !secret casts_pass

#Basement UPS
#  - platform: apcupsd
#    resources:
#      - bcharge
#      - linev
#      - loadpct
#      - nominv
#      - numxfers
#      - status
#      - timeleft
#      - tonbatt
# Tracking Ryan to Home
 - platform: google_travel_time
   name: Ryan To Home
   api_key: !secret google_api
   origin: device_tracker.ryan_note8
   destination: zone.home
# Tracking Ryan to Work
 - platform: google_travel_time
   name: Ryan To Work
   api_key: !secret google_api
   origin: device_tracker.ryan_note8
   destination: zone.pivot
# Tracking Kristi to Home
 - platform: google_travel_time
   name: Kristi To Home
   api_key: !secret google_api
   origin: device_tracker.kristi_s7
   destination: zone.home

### Sensors from SmartThings
##Light Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/illuminance/state"
   name: "First Floor Entry Light"
   qos: 0
   unit_of_measurement: 'lux'
 - platform: mqtt
   state_topic: "smartthings/Bathroom Motion/illuminance/state"
   name: "Bathroom Motion Light Sensor"
   qos: 0
   unit_of_measurement: 'lux'
 - platform: mqtt
   state_topic: "smartthings/Bedroom Motion/illuminance/state"
   name: "Bedroom Motion Light Sensor"
   qos: 0
   unit_of_measurement: 'lux'
 - platform: mqtt
   state_topic: "smartthings/Office Motion/illuminance/state"
   name: "Office Motion Light Sensor"
   qos: 0
   unit_of_measurement: 'lux'
#Humidity Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/humidity/state"
   name: "First Floor Entry Humidity"
   qos: 0
   unit_of_measurement: '%RH'
 - platform: mqtt
   state_topic: "smartthings/Humidor Sensor/humidity/state"
   name: "Humidor Humidity"
   qos: 0
   unit_of_measurement: '%RH'
 - platform: mqtt
   state_topic: "smartthings/Liam's Room Sensor/humidity/state"
   name: "Liam's Room Humidity"
   qos: 0
   unit_of_measurement: '%RH'
#Temperature Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/temperature/state"
   name: "First Floor Entry Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Liam's Room Sensor/temperature/state"
   name: "Liam's Room Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Humidor Sensor/temperature/state"
   name: "Humidor Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Kitchen Motion/temperature/state"
   name: "Kitchen Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement Motion/temperature/state"
   name: "Basement Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Iris 3405-L Keypad/temperature/state"
   name: "Entry Keypad Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Motion/temperature/state"
   name: "Upstairs Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement North Window/temperature/state"
   name: "Basement North Window Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 1/temperature/state"
   name: "Basement South Window 1 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 2/temperature/state"
   name: "Basement South Window 2 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Front Window 1/temperature/state"
   name: "Front Window 1 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Front Window 2/temperature/state"
   name: "Front Window 2 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Window Over Sink/temperature/state"
   name: "Window Over Sink Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/temperature/state"
   name: "Washer Sensor Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/temperature/state"
   name: "Dryer Sensor Temperature"
   qos: 0
   unit_of_measurement: '°F'
#Battery Sensors
 - platform: mqtt
   state_topic: "smartthings/Window Over Sink/battery/state"
   name: "Window Over Sink Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/battery/state"
   name: "Dryer Sensor Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/battery/state"
   name: "Washer Sensor Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Play Room Window/battery/state"
   name: "Play Room Window Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Front Window 1/battery/state"
   name: "Front Window 1 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 2/battery/state"
   name: "Basement South Window 2 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 1/battery/state"
   name: "Basement South Window 1 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement North Window/battery/state"
   name: "Basement North Window Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Play Room Window/battery/state"
   name: "Play Room Window Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Keypad/battery/state"
   name: "Entry Keypad Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Motion/battery/state"
   name: "Upstairs Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement Motion/battery/state"
   name: "Basement Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Kitchen Motion/battery/state"
   name: "Kitchen Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/battery/state"
   name: "First Floor Entry Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Bathroom Motion/battery/state"
   name: "Bathroom Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Bedroom Motion/battery/state"
   name: "Bedroom Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Office Motion/battery/state"
   name: "Office Motion Battery"
   qos: 0
   unit_of_measurement: '%'
##SmartThings Pre1sence
 # - platform: mqtt
   # state_topic: "smartthings/Ryan's Phone/presence"
   # name: "ST Ryan"
   # qos: 0
#Vibration Sensors
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/threeAxis/state"
   name: "Dryer Movement"
   qos: 0
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/threeAxis/state"
   name: "Washer Movement"
   qos: 0
#Power Sensors   
 - platform: mqtt
   state_topic: "smartthings/Washer/power/state"
   name: "Washer Power"
   qos: 0
   unit_of_measurement: 'W'
#SmartThings Template Sensors
 - platform: template
   sensors:
     ryan_smartthings:
       value_template: '{% if is_state("sensor.st_ryan", "present") %}Home{% else %}Away{% endif %}'
       friendly_name: "Ryan's SmartThings"
 - platform: mqtt
   state_topic: "smartthings/Kristi's Phone/presence"
   name: "ST Kristi"
   qos: 0
 - platform: template
   sensors:
     kristi_smartthings:
       value_template: '{% if is_state("sensor.st_kristi", "present") %}Home{% else %}Away{% endif %}'
       friendly_name: "Kristi's SmartThings"
##OwnTracks Data
 - platform: template
   sensors:
     ryan_battery:
       value_template: '{{ states.device_tracker.ryan_note8.attributes.battery }}'
       unit_of_measurement: '%'
       friendly_name: "Ryan Phone Battery"
 - platform: template
   sensors:
     kristi_battery:
       value_template: '{{ states.device_tracker.kristi_s7.attributes.battery }}'
       unit_of_measurement: '%'
       friendly_name: "Kristi Phone Battery"

##FIND Location
 - platform: rest
   resource: !secret find_name
   value_template: !secret find_template
   method: GET
   name: Ryan FIND Sensor
   scan_interval: 1
####PACKAGE SENSORS
#UPS Packages
 - platform: ups
   username: !secret username
   password: !secret ups_pass
##USPS Camera
 - platform: usps
   scan_interval: 5
##FedEx Packages
 - platform: fedex
   username: !secret username
   password: !secret fedex_pass
 - platform: travisci
   api_key:  !secret travis_api
##presence server
 - platform: mqtt
   state_topic: !secret 1stryanphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Ryan First Floor'
 - platform: mqtt
   state_topic: !secret 2ndryanphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Ryan Second Floor'
 # - platform: mqtt
   # state_topic: !secret baseryanphonebt
   # value_template: '{{ value_json.confidence }}'
   # unit_of_measurement: '%'
   # name: 'Ryan Basement'
 - platform: mqtt
   state_topic: !secret 1stkristiphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Kristi First Floor'
 - platform: mqtt
   state_topic: !secret 2ndkristiphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Kristi Second Floor'
 # - platform: mqtt
   # state_topic: !secret basekristiphonebt
   # value_template: '{{ value_json.confidence }}'
   # unit_of_measurement: '%'
   # name: 'Kristi Basement'
 - platform: mqtt
   state_topic: !secret 1stmomphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Mom First Floor'
 - platform: mqtt
   state_topic: !secret 2ndmomphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Mom Second Floor'
 # - platform: mqtt
   # state_topic: !secret basemomphonebt
   # value_template: '{{ value_json.confidence }}'
   # unit_of_measurement: '%'
   # name: 'Mom Basement'
 - platform: mqtt
   state_topic: !secret 1stdadphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Dad First Floor'
 - platform: mqtt
   state_topic: !secret 2nddadphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Dad Second Floor'
 - platform: mqtt
   state_topic: !secret 1stoutlanderbt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Outlander First Floor'
 - platform: mqtt
   state_topic: !secret 1stvolvobt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Volvo First Floor'
 - platform: mqtt
   state_topic: !secret 1sttestbt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Test First Floor'
##BT presence logic
 - platform: min_max
   name: "Ryan Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.ryan_first_floor
     - sensor.ryan_second_floor
    #  - sensor.ryan_basement
 - platform: min_max
   name: "Kristi Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.kristi_first_floor
     - sensor.kristi_second_floor
    #  - sensor.kristi_basement
 - platform: min_max
   name: "Mom Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.mom_first_floor
     - sensor.mom_second_floor
    #  - sensor.mom_basement
 - platform: min_max
   name: "Dad Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.dad_first_floor
     - sensor.dad_second_floor
    #  - sensor.mom_basement
##BT Occupancy Sensors
 - platform: template
   sensors:
     ryan_occupancy:
       value_template: '{% if states("sensor.ryan_home_occupancy_confidence") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Ryan's BT Occupancy"
 - platform: template
   sensors:
     kristi_occupancy:
       value_template: '{% if states("sensor.kristi_home_occupancy_confidence") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Kristi's BT Occupancy"
 - platform: template
   sensors:
     mom_occupancy:
       value_template: '{% if states("sensor.mom_home_occupancy_confidence") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Mom's BT Occupancy"
 - platform: template
   sensors:
     dad_occupancy:
       value_template: '{% if states("sensor.dad_home_occupancy_confidence") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Dad's BT Occupancy"
 - platform: template
   sensors:
     outlander:
       value_template: '{% if states("sensor.outlander_first_floor") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Outlander Garage"
 - platform: template
   sensors:
     volvo:
       value_template: '{% if states("sensor.volvo_first_floor") | float > 10 %}home{% else %}not_home{%endif %}'
       friendly_name: "Volvo Garage"
##Bayesian Device Tracker
 - platform: template
   sensors:
     ryan_home:
       value_template:
         "{% if is_state('binary_sensor.ryan_presence', 'on') %}
         Home
         {% else %}
         not_home
         {% endif %}"
       friendly_name: Ryan Home
 - platform: template
   sensors:
     kristi_home:
       value_template:
         "{% if is_state('binary_sensor.kristi_presence', 'on') %}
         Home
         {% else %}
         not_home
         {% endif %}"
       friendly_name: Kristi Home
 - platform: template
   sensors:
     mom_home:
       value_template:
         "{% if is_state('binary_sensor.mom_presence', 'on') %}
         Home
         {% else %}
         not_home
         {% endif %}"
       friendly_name: Mom Home
 - platform: template
   sensors:
     dad_home:
       value_template:
         "{% if is_state('binary_sensor.dad_presence', 'on') %}
         Home
         {% else %}
         not_home
         {% endif %}"
       friendly_name: Dad Home

 - platform: template
   sensors:
     weather_alert:
       value_template:
         "{% if states.sensor.pws_alerts|regex_search('_TOR') %}Tornado Warning
         {% elif states.sensor.pws_alerts.attributes|regex_search('_TOW') %}Tornado Watch
         {% elif states.sensor.pws_alerts.attributes|regex_search('_WRN') %}Severe Thunderstorm Warning
         {% elif states.sensor.pws_alerts.attributes|regex_search('_FLO') %}Flood Warning
         {% elif states.sensor.pws_alerts.attributes|regex_search('_WIN') %}Winter Storm Advisory
         {% else %}
         No Alert
         {% endif %}"
       friendly_name: Weather Alert

#  - platform: rest
#    sensors:
#      resource: http://localhost:7999/1/detection/status
#      method: GET
#      name: Back Deck Motion Record
#      value_template: '{{ value }}'
       
 #- platform: zoneminder
 #  include_archived: false