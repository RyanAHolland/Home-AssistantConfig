#HASS Version
 - platform: version
# Weather Prediction
 - platform: darksky
   api_key: !secret dark_sky_api
   update_interval: '00:10'
   monitored_conditions:
      - summary
      - precip_type
      - precip_intensity
      - precip_probability
      - temperature
      - apparent_temperature
      - wind_speed
      - wind_bearing
      - cloud_cover
      - humidity
      - daily_summary
      - temperature_max
      - temperature_min
      - precip_intensity_max
# Roomba  Control
 - platform: thinkingcleaner
# TED500
 - platform: ted5000
   name: main
   host: !secret ted_ip
   port: 80
# Speed Test
 - platform: speedtest
   monitored_conditions:
     - ping
     - download
     - upload
#PLEX
 - platform: plex
   username: !secret email
   password: !secret plex_pass
#SABNZBD
 - platform: sabnzbd
   host: !secret sabnzbd_host
   api_key: !secret sabnzbd_api
   monitored_variables:
     - 'current_status'
     - 'speed'
     - 'queue_size'
     - 'queue_remaining'
     - 'disk_size'
     - 'disk_free'
     - 'queue_count'
#RING
 - platform: ring
   monitored_conditions:
     - battery
     - last_activity
     - last_ding
     - last_motion
     - volume

#Pocket Casts
 - platform: pocketcasts
   username: !secret email
   password: !secret casts_pass

#Basement UPS
 - platform: apcupsd
   resources:
     - bcharge
     - linev
     - loadpct
     - nominv
     - numxfers
     - status
     - timeleft
     - tonbatt
# Tracking Ryan to Home
 - platform: google_travel_time
   name: Ryan To Home
   api_key: !secret google_api
   origin: device_tracker.ryan_note8
   destination: zone.home
# Tracking Ryan to Work
 - platform: google_travel_time
   name: Ryan To Work
   api_key: !secret google_api
   origin: device_tracker.ryan_note8
   destination: zone.pivot
# Tracking Kristi to Home
 - platform: google_travel_time
   name: Kristi To Home
   api_key: !secret google_api
   origin: device_tracker.kristi_s5
   destination: zone.home

### Sensors from SmartThings
##Light Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/illuminance"
   name: "First Floor Entry Light"
   qos: 0
   unit_of_measurement: 'lux'
 - platform: mqtt
   state_topic: "smartthings/Bathroom Motion/illuminance"
   name: "Bathroom Motion Light Sensor"
   qos: 0
   unit_of_measurement: '%'
#Humidity Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/humidity"
   name: "First Floor Entry Humidity"
   qos: 0
   unit_of_measurement: '%RH'
 - platform: mqtt
   state_topic: "smartthings/Humidor Sensor/humidity"
   name: "Humidor Humidity"
   qos: 0
   unit_of_measurement: '%RH'
#Temperature Sensors
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/temperature"
   name: "First Floor Entry Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Humidor Sensor/temperature"
   name: "Humidor Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Kitchen Motion/temperature"
   name: "Kitchen Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement Motion/temperature"
   name: "Basement Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Iris 3405-L Keypad/temperature"
   name: "Entry Keypad Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Motion/temperature"
   name: "Upstairs Motion Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement North Window/temperature"
   name: "Basement North Window Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 1/temperature"
   name: "Basement South Window 1 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 2/temperature"
   name: "Basement South Window 2 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Front Window 1/temperature"
   name: "Front Window 1 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Front Window 2/temperature"
   name: "Front Window 2 Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Window Over Sink/temperature"
   name: "Window Over Sink Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/temperature"
   name: "Washer Sensor Temperature"
   qos: 0
   unit_of_measurement: '°F'
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/temperature"
   name: "Dryer Sensor Temperature"
   qos: 0
   unit_of_measurement: '°F'
#MySensors
 - platform: mqtt
   state_topic: "mysensors/3/0/1/0/0"
   name: "Bedroom Temperature"
   qos: 0
   unit_of_measurement: '°F'
#Battery Sensors
 - platform: mqtt
   state_topic: "smartthings/Window Over Sink/battery"
   name: "Window Over Sink Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/battery"
   name: "Dryer Sensor Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/battery"
   name: "Washer Sensor Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Play Room Window/battery"
   name: "Play Room Window Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Front Window 1/battery"
   name: "Front Window 1 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 2/battery"
   name: "Basement South Window 2 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement South Window 1/battery"
   name: "Basement South Window 1 Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement North Window/battery"
   name: "Basement North Window Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Keypad/battery"
   name: "Entry Keypad Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Upstairs Motion/battery"
   name: "Upstairs Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Basement Motion/battery"
   name: "Basement Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/Kitchen Motion/battery"
   name: "Kitchen Motion Battery"
   qos: 0
   unit_of_measurement: '%'
 - platform: mqtt
   state_topic: "smartthings/First Floor Entry/battery"
   name: "First Floor Entry Battery"
   qos: 0
   unit_of_measurement: '%'
##SmartThings Pre1sence
 - platform: mqtt
   state_topic: "smartthings/Ryan's Phone/presence"
   name: "ST Ryan"
   qos: 0
##Vibration Sensors
 - platform: mqtt
   state_topic: "smartthings/Dryer Sensor/threeAxis"
   name: "Dryer Movement"
   qos: 0
 - platform: mqtt
   state_topic: "smartthings/Washer Sensor/threeAxis"
   name: "Washer Movement"
   qos: 0
#Power Sensors   
 - platform: mqtt
   state_topic: "smartthings/Washer/power"
   name: "Washer Power"
   qos: 0
   unit_of_measurement: 'W'
#SmartThings Template Sensors
 - platform: template
   sensors:
     ryan_smartthings:
       value_template: '{% if is_state("sensor.st_ryan", "present") %}Home{% else %}Away{% endif %}'
       friendly_name: "Ryan's SmartThings"
 - platform: mqtt
   state_topic: "smartthings/Kristi's Phone/presence"
   name: "ST Kristi"
   qos: 0
 - platform: template
   sensors:
     kristi_smartthings:
       value_template: '{% if is_state("sensor.st_kristi", "present") %}Home{% else %}Away{% endif %}'
       friendly_name: "Kristi's SmartThings"
##OwnTracks Data
 - platform: template
   sensors:
     ryan_battery:
       value_template: '{{ states.device_tracker.ryan_note8.attributes.battery }}'
       unit_of_measurement: '%'
       friendly_name: "Ryan Phone Battery"
 - platform: template
   sensors:
     kristi_battery:
       value_template: '{{ states.device_tracker.kristi_s7.attributes.battery }}'
       unit_of_measurement: '%'
       friendly_name: "Kristi Phone Battery"

##FIND Location
 - platform: rest
   resource: !secret find_name
   value_template: !secret find_template
   method: GET
   name: Ryan FIND Sensor
   scan_interval: 1
####PACKAGE SENSORS
#UPS Packages
 - platform: ups
   username: !secret username
   password: !secret ups_pass
##USPS Camera
 - platform: usps
   scan_interval: 5
##FedEx Packages
 - platform: fedex
   username: !secret username
   password: !secret fedex_pass
 - platform: travisci
   api_key:  !secret travis_api
##presence server
 - platform: mqtt
   state_topic: !secret 1stryanphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Ryan First Floor'
 - platform: mqtt
   state_topic: !secret 2ndryanphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Ryan Second Floor'
 - platform: mqtt
   state_topic: !secret baseryanphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Ryan Basement'
 - platform: mqtt
   state_topic: !secret 1stkristiphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Kristi First Floor'
 - platform: mqtt
   state_topic: !secret 2ndkristiphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Kristi Second Floor'
 - platform: mqtt
   state_topic: !secret basekristiphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Kristi Basement'
 - platform: mqtt
   state_topic: !secret 1stmomphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Mom First Floor'
 - platform: mqtt
   state_topic: !secret 2ndmomphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Mom Second Floor'
 - platform: mqtt
   state_topic: !secret basemomphonebt
   value_template: '{{ value_json.confidence }}'
   unit_of_measurement: '%'
   name: 'Mom Basement'
##BT presence logic
 - platform: min_max
   name: "Ryan Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.ryan_first_floor
     - sensor.ryan_second_floor
     - sensor.ryan_basement
 - platform: min_max
   name: "Kristi Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.kristi_first_floor
     - sensor.kristi_second_floor
     - sensor.kristi_basement
 - platform: min_max
   name: "Mom Home Occupancy Confidence"
   type: mean
   round_digits: 0
   entity_ids:
     - sensor.mom_first_floor
     - sensor.mom_second_floor
     - sensor.mom_basement
##BT Occupancy Sensors
 - platform: template
   sensors:
     ryan_occupancy:
       value_template: '{% if states("sensor.ryan_home_occupancy_confidence") | float > 10 %}Home{% else %}Away{%endif %}'
       friendly_name: "Ryan's BT Occupancy"
 - platform: template
   sensors:
     kristi_occupancy:
       value_template: '{% if states("sensor.kristi_home_occupancy_confidence") | float > 10 %}Home{% else %}Away{%endif %}'
       friendly_name: "Kristi's BT Occupancy"
 - platform: template
   sensors:
     mom_occupancy:
       value_template: '{% if states("sensor.mom_home_occupancy_confidence") | float > 10 %}Home{% else %}Away{%endif %}'
       friendly_name: "Mom's BT Occupancy"
 - platform: bayesian
   prior: 0.5
   name: 'Ryan Presence'
   probability_threshold: 0.9
   observations:
     - entity_id: 'device_tracker.ryan_note8'
       prob_given_true: 0.9
       prob_given_false: 0.1
       platform: 'state'
       to_state: 'home'
     - entity_id: 'device_tracker.galaxy-note8'
       prob_given_true: 0.7
       prob_given_false: 0.1
       platform: 'state'
       to_state: 'home'
     - entity_id: 'sensor.ryan_occupancy'
       prob_given_true: 0.9
       prob_given_false: 0.3
       platform: 'state'
       to_state: 'home'
